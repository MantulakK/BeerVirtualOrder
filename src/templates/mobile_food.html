<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Comida</title>
</head>

<style>

.card-body{
    color: #40240c;
    background-color: #dfde9c;
    font-family: Georgia, 'Times New Roman', Times, fantasy;
}

</style>

<body class="bg-dark text-light">

    <div class="container">
        <div class="row mb-3">
            <div class="col d-flex align-items-center">
                <h1 class="center">Comidas</h1>
            </div>
            <div class="col-auto">
                
                    <img src="../static/img/home.png" width="150">
            
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            {% for article in articles %}
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        
                        <h5 class="card-title">{{ article.name }}</h5>
                        <strong>
                            <p class="card-text">{{ article.brand }}</p>
                            <p class="card-text">{{ article.description }}</p>
                            <p class="card-text">$ {{ article.single_price }}</p>
                        </strong>
                        <button class="btn btn-primary add-to-cart-btn" style="color: black; background-color: darkseagreen;"
                            data-article-id="{{ article.id_article }}"
                            data-article-name="{{ article.name }}"
                            onclick="openQuantityModal(this)"
                            data-table-number="{{ table_number }}"
                            data-article-price="{{ article.single_price }}">Al Carrito
                            <i class="fa fa-cart-plus" aria-hidden="true"></i>
                        </button>
                        <!-- Puedes agregar más detalles aquí según sea necesario -->
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

<!-- Al final del archivo -->
<div class="modal fade" id="quantityModal" tabindex="-1" aria-labelledby="quantityModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quantityModalLabel" style="color: black">Ingresar Cantidad</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="number" class="form-control" id="modalQuantityInput" value="1" min="1">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="confirmQuantityBtn" onclick="confirmQuantity()">Confirmar</button>
            </div>
        </div>
    </div>
</div>



</body>

<script>
        const table_number = localStorage.getItem('table_number');
        console.log(table_number);

        let selectedArticle = null; // Variable para almacenar el artículo seleccionado
        let cartItems = []; // Inicializa cartItems

        function openQuantityModal(btn) {
            // Obtiene los datos del botón
            selectedArticle = {
                id: parseInt(btn.getAttribute('data-article-id')),
                name: btn.getAttribute('data-article-name'),
                price: parseFloat(btn.getAttribute('data-article-price')),
            };
            console.log(selectedArticle)

            // Configura los datos en el modal
            document.getElementById('modalQuantityInput').value = 1;
            $('#quantityModal').modal('show');
        }

        function confirmQuantity() {
            // Obtiene la cantidad ingresada
            let quantity = parseInt(document.getElementById('modalQuantityInput').value);

            // Verifica que la cantidad sea válida
            if (quantity > 0) {
                // Actualiza la cantidad en el artículo seleccionado
                selectedArticle.quantity = quantity;

                // Agrega el artículo al carrito
                addToCart(selectedArticle);

                // Resetea la variable selectedArticle
                selectedArticle = null;

                // Cierra el modal después de agregar al carrito
                $('#quantityModal').modal('hide');
            } else {
                alert('Por favor, ingrese una cantidad válida.');
            }
        }

        function addToCart(article) {
            // Verificar si el artículo ya está en el carrito
            let existingItem = cartItems.find(item => item.id === article.id);

            if (existingItem) {
                // Si ya está en el carrito, actualiza la cantidad
                existingItem.quantity += article.quantity;
            } else {
                // Si no está en el carrito, agrégalo
                cartItems.push(article);
            }

            // Actualiza la vista del carrito
            updateCartView();

            // Envía una solicitud POST al servidor Flask para agregar al carrito
            fetch('/mobile_food/add_to_cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'article_id': article.id,
                    'article_name': article.name,
                    'article_price': article.price,
                    'quantity': article.quantity,
                    'table_number': table_number,
                }),
            })
                .then(response => response.json())
                .then(data => console.log(data))
                .catch(error => console.error('Error:', error));
        }

        function updateCartView() {
            // Implementa la lógica para actualizar la vista del carrito aquí
        }
</script>

</html>