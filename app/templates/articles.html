<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gestión de Artículos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-pvL5YnZSbCrld8p7atCq2JXb1b8FvReUtXWIdA0MZ1KbW/GS0+LZw+5yTGJjkqSsDfSxpvjJGqlF9ryetZ3eRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

<style>
    body.dark-background {
        background-color: #333333 !important;
        color: #ffffff !important;
    }

    table.dark-table {
        background-color: #333333 !important;
    }

    table.dark-table td {
        color: #000000 !important;
    }
</style>


</head>
<body class="bg-dark text-light">

    <div class="container">
        <div class="row mb-3">
            <div class="col d-flex align-items-center">
                <h1 class="center"> Gestión de Artículos </h1>
            </div>
            <div class="col-auto">
                <a class="navbar-brand" href="{{ url_for('index') }}">
                    <img src="../static/img/home.png" width="150">
                </a>
            </div>
        </div>
    </div>
<!--  ESTE BLOQUE SE USA PARA PODER MOSTRAR UN MENSAJE EN CASO DE QUE SE DETECTE UNA INSERCIÓN DE UN ARTICULO CON UN NOMBRE YA EXISTENTE O DE UNA INSERCIÓN EXITOSA    -->
    <div class="container">
        <div class="card">
            <div class="card-body">
                {% with messages = get_flashed_messages() %}
                  {% if messages %}
                    <div class="alert alert-info">
                      <ul>
                        {% for message in messages %}
                          <li>{{ message }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                {% endwith %}

<!-- BLOQUE DE CREACIÓN  -->
    <div class="container">
        <div class="card">
            <div class="card-body">
                <form action="{{ url_for('articles.create_article') }}" method="POST" class="bg-dark text-light">
                    <div class="row mb-3">
                        <div class="col bg-dark">
                            <b><label>Nombre de Artículo</label></b>
                            <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Insert Name" name="name" id="name" required>
                        </div>

                        <div class="col bg-dark">
                            <b><label>Marca</label></b>
                            <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Insert Brand" name="brand" id="brand" required>
                        </div>

                        <div class="col bg-dark">
                            <b><label>Descripción</label></b>
                            <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Insert Description" name="description" id="description" required>
                        </div>

                        <div class="col bg-dark">
                            <b><label>Tipo</label></b>
                            <select name="article_type" id="article_type"  class="form-control mb-3">
                                <option value="1">Comida</option>
                                <option value="2">Bebida</option>
                            </select>
                        </div>

                        <div class="col bg-dark">
                            <b><label>Single Price</label></b>
                            <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Insert Price" name="single_price" id="single_price" required>
                        </div>

                        <div class="col bg-dark">
                            <button class="btn btn-success mb-3 mt-4" type="submit" onclick="confirm('CREAR ARTÍCULO?')">Crear Artículo</button>
                            <button class="btn btn-danger mb-3 mt-4" type="button" onclick="clearFields(); alert('CREACION CANCELADA!');">Cancelar</button>
                        </div>
                        
                    </div>

                </form>


<!-- FILTROS -->
              <div class="row mb-3">
                <div class="col">
                    <b><label>Filtrar Nombre</label></b>
                    <input type="text" class="form-control" id="filterName">
                </div>
                <div class="col">
                    <b><label>Filtrar Marca</label></b>
                    <input type="text" class="form-control" id="filterBrand">
                </div>
                <div class="col">
                    <b><label>Filtrar Descripción</label></b>
                    <input type="text" class="form-control" id="filterDescription">
                </div>
                <div class="col">
                    <button class="btn btn-primary mt-4" onclick="applyFilters()">Aplicar Filtros</button>
                </div>
            </div>                


<!-- TABLA -->
<table class="table table-bordered table-dark" id="articlesTable">
    <thead>
        <th scope="col">#</th>
        <th scope="col">Nombre</th>
        <th scope="col">Marca</th>
        <th scope="col">Descripción</th>
        <th scope="col">Tipo</th>
        <th scope="col">Precio</th>
        <th scope="col">EDITAR</th>
    </thead>
    <tbody class="dark-text bg-dark"> <!-- A ESTE ELEMENTO SE LE AGREGAN LOS DATOS DE LA BASE DE DATOS -->
        {% for article in articles %}
        <tr>
          <td>{{ article['id_article'] }}</td>
          <td>{{ article['name'] }}</td>
          <td>{{ article['brand'] }}</td>
          <td>{{ article['description'] }}</td>
          <td>
            {% if article['article_type'] == 1 %}
                Comida
            {% elif article['article_type'] == 2 %}
                Bebida
            {% endif %}
          </td>
          <td>{{ article['single_price'] }}</td>
          <td><button class="btn btn-primary btn-sm" id="modal{{article.id_article}}" data-bs-toggle="modal" data-bs-target="#modal{{article.id_article}}">EDITAR</button><!--<a href="#">Edit</a></td>-->
        </tr>

        <!-- VENTANA MODAL  -->
        <div class="modal fade" id="modal{{article.id_article}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-5" id="exampleModalLabel">{{article.name}}</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('articles.edit_article', id_article=article['id_article']) }}" method="POST">
                        <label>Nombre de Articulo</label>
                        <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Edit Name" name="name" value="{{article.name}}" required>
                        
                        <label>Marca</label>
                        <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Edit Brand" name="brand" value="{{article.brand}}" required>                      

                        <label>Descripción</label>
                        <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Edit Description" name="description" value="{{article.description}}" required>

                        <label>Tipo</label>
                        <select name="article_type" id="article_type"  class="form-control mb-3">
                            <option value="1">Comida</option>
                            <option value="2">Bebida</option>
                        </select>
                        
                        <label>Single Price</label>
                        <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Edit Price" name="single_price" value="{{article.single_price}}" required>

                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
              </div>
            </div>
          </div>

      {% endfor %}
    </tbody>
</table>


            </div>
        </div>
    </div>
<!-- FUNCION PARA LIMPAR LOS CAMPOS DE CREACION  -->
    <script>
        function clearFields() {
            document.getElementById("name").value = "";
            document.getElementById("brand").value = "";
            document.getElementById("description").value = "";
            document.getElementById("single_price").value = "";
        }
    </script>

<script>
    function applyFilters() {
        var filterName = document.getElementById("filterName").value.toLowerCase();
        var filterBrand = document.getElementById("filterBrand").value.toLowerCase();
        var filterDescription = document.getElementById("filterDescription").value.toLowerCase();
        var tableRows = document.getElementById("articlesTable").getElementsByTagName("tbody")[0].getElementsByTagName("tr");
            
        for (var i = 0; i < tableRows.length; i++) {
            var name = tableRows[i].getElementsByTagName("td")[1].textContent.toLowerCase();
            var brand = tableRows[i].getElementsByTagName("td")[2].textContent.toLowerCase();
            var description = tableRows[i].getElementsByTagName("td")[3].textContent.toLowerCase();
            
            // Create regular expressions with the 'i' and 'u' flags for case-insensitive and Unicode matching
            var nameRegex = new RegExp(filterName.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&'), 'iu');
            var brandRegex = new RegExp(filterBrand.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&'), 'iu');
            var descriptionRegex = new RegExp(filterDescription.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&'), 'iu');
            
            if (name.match(nameRegex) && brand.match(brandRegex) && description.match(descriptionRegex)) {
                tableRows[i].style.display = "";
            } else {
                tableRows[i].style.display = "none";
            }
        }
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js" integrity="sha512-K9Y3mTPQpUhln7kwYMr9eY75Ry3bPj/4v34+WaMIBjv2Zc46Q88GoytEamCr4MycNlwssbbzS7Cznb5iqQJ8QA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>