<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Orders</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-pvL5YnZSbCrld8p7atCq2JXb1b8FvReUtXWIdA0MZ1KbW/GS0+LZw+5yTGJjkqSsDfSxpvjJGqlF9ryetZ3eRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

<style>
    body.dark-background {
        background-color: #333333 !important;
        color: #ffffff !important;
    }

    table.dark-table {
        background-color: #333333 !important;
    }

    table.dark-table td {
        color: #000000 !important;
    }
</style>


</head>
<body class="bg-dark text-light">

    <div class="container">
        <div class="row mb-3">
            <div class="col d-flex align-items-center">
                <h1 class="center">Orders</h1>
            </div>
            <div class="col-auto">
                <a class="navbar-brand" href="{{ url_for('index') }}">
                    <img src="../static/img/home.png" width="150">
                </a>
            </div>
        </div>
    </div>
<!--  ESTE BLOQUE SE USA PARA PODER MOSTRAR UN MENSAJE EN CASO DE QUE SE DETECTE UNA INSERCIÓN DE UN ARTICULO CON UN NOMBRE YA EXISTENTE O DE UNA INSERCIÓN EXITOSA    -->
    <div class="container">
        <div class="card">
            <div class="card-body">
                {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="alert alert-info">
                    <ul>
                        {% for message in messages %}
                        <li>{{ message }}</li>
                        {% endfor %}
                    </ul>
                    </div>
                {% endif %}
                {% endwith %}

<!-- BLOQUE DE CREACIÓN  -->
    <div class="container">
        <div class="card">
            <div class="card-body">
                <form action="{{ url_for('orders.create_order') }}" method="POST" class="bg-dark text-light">
                    <div class="row mb-3">

                        <div class="col bg-dark">
                            <b><label>Description (Type - Ingredients)</label></b>
                            <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Insert Description" name="description" id="description" required>
                        </div>

                        <div class="col bg-dark">
                            <b><label>Order Price</label></b>
                            <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Insert Price" name="order_price" id="order_price" required>
                        </div>

                        <div class="col bg-dark">
                            <button class="btn btn-success mb-3 mt-4" type="submit" onclick="confirm('DO YOU WANT TO ADD THIS DATA?')">Submit Item</button>
                            <button class="btn btn-danger mb-3 mt-4" type="button" onclick="clearFields(); alert('SUBMIT CANCELED!');">Cancel</button>
                        </div>
                        
                    </div>

                </form>


<!-- FILTROS -->
            <div class="row mb-3">
                <div class="col">
                    <b><label>Filter Name</label></b>
                    <input type="text" class="form-control" id="filterName">
                </div>
                <div class="col">
                    <b><label>Filter Description</label></b>
                    <input type="text" class="form-control" id="filterDescription">
                </div>
                <div class="col">
                    <button class="btn btn-primary mt-4" onclick="applyFilters()">Apply Filters</button>
                </div>
            </div>                





<!-- TABLA -->
<table class="table table-bordered table-dark" id="mainorder">
    <thead>
        <th scope="col">Description</th>
        <th scope="col">Price</th>
        <th scope="col">EDIT</th>
    </thead>
    <tbody class="dark-text bg-dark"> <!-- A ESTE ELEMENTO SE LE AGREGAN LOS DATOS DE LA BASE DE DATOS -->
        {% for orders in orders %}
        <tr>
        <td>{{ orders['description'] }}</td>
        <td>{{ orders['orders_price'] }}</td>
        <td><button class="btn btn-primary btn-sm" id="modal{{orders.id_mainorder}}" data-bs-toggle="modal" data-bs-target="#modal{{orders.id_mainorder}}">EDIT</button><!--<a href="#">Edit</a></td>-->
        </tr>

        <!-- VENTANA MODAL  -->
        <div class="modal fade" id="modal{{orders.id_mainorder}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">{{orders.description}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{{ url_for('orders.edit_orders', id_mainorder=orders['id_mainorder']) }}" method="POST">      

                        <label>Description</label>
                        <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Edit Description" name="description" value="{{orders.description}}" required>

                        <label>Order Price</label>
                        <input type="text" class="form-control mb-3" autocomplete="off" placeholder="Edit Price" name="orders_price" value="{{orders.order_price}}" required>

                </div>
                <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
            </div>
            </div>
        </div>

    {% endfor %}
    </tbody>
</table>


            </div>
        </div>
    </div>
<!-- FUNCION PARA LIMPAR LOS CAMPOS DE CREACION  -->
    <script>
        function clearFields() {
            document.getElementById("description").value = "";
            document.getElementById("order_price").value = "";
        }
    </script>

    <!-- JavaScript code: FUNCION PARA APLICAR FILTROS PARA BUSCAR ARTICULOS EN ESPECÍFICO -->
    <script>
        function applyFilters() {
            var filterDescription = document.getElementById("filterDescription").value.toLowerCase();
            var tableRows = document.getElementById("td").getElementsByTagName("tbody")[0].getElementsByTagName("tr");
            
            for (var i = 0; i < tableRows.length; i++) {
                var name = tableRows[i].getElementsByTagName("td")[1].textContent.toLowerCase();
                var description = tableRows[i].getElementsByTagName("td")[2].textContent.toLowerCase();
                
                if (name.includes(filterName) && description.includes(filterDescription)) {
                    tableRows[i].style.display = "";
                } else {
                    tableRows[i].style.display = "none";
                }
            }
        }
    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js" integrity="sha512-K9Y3mTPQpUhln7kwYMr9eY75Ry3bPj/4v34+WaMIBjv2Zc46Q88GoytEamCr4MycNlwssbbzS7Cznb5iqQJ8QA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>